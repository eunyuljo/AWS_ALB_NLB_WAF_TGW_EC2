# AWS Central-Spoke Architecture with Load Balancers and Proxy

ì´ í”„ë¡œì íŠ¸ëŠ” AWSì—ì„œ Central-Spoke ì•„í‚¤í…ì²˜ë¥¼ êµ¬í˜„í•˜ì—¬ ì¤‘ì•™ ì§‘ì¤‘ì‹ ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ì™€ ë³´ì•ˆ ì²˜ë¦¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                INTERNET                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚           Central VPC (10.0.0.0/16)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                           â”‚                                              â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚   â”‚            Internet Gateway (IGW)                                â”‚   â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                           â”‚                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚              Public Subnets                                       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”‚  ap-northeast-2a â”‚ â”‚ â”‚  ap-northeast-2c â”‚                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”‚   10.0.0.0/24    â”‚ â”‚ â”‚   10.0.1.0/24    â”‚                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚              â”‚         â”‚         â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚              â”‚    Internet-facing ALB                             â”‚   â”‚  â”‚
â”‚  â”‚  â”‚              â”‚         â”‚         â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”‚   NAT Gateway    â”‚ â”‚ â”‚   NAT Gateway    â”‚                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”‚     (AZ-a)       â”‚ â”‚ â”‚     (AZ-c)       â”‚                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                           â”‚                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚             Private Subnets                                       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”‚  ap-northeast-2a â”‚ â”‚ â”‚  ap-northeast-2c â”‚                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”‚  10.0.10.0/24    â”‚ â”‚ â”‚  10.0.11.0/24    â”‚                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚              â”‚         â”‚         â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚              â”‚    Internal NLB                                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚              â”‚         â”‚         â”‚                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”‚  Nginx Proxy     â”‚ â”‚ â”‚  Nginx Proxy     â”‚                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”‚   (Port 8080)    â”‚ â”‚ â”‚   (Port 8080)    â”‚                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚                                                  â”‚
â”‚               Transit Gateway (Hub-Spoke Router)                                â”‚
â”‚                              â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚           Spoke VPC (10.1.0.0/16)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                           â”‚                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚              Subnets (No Internet Gateway)                         â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”‚  Main Subnet     â”‚ â”‚ â”‚ Private Subnet   â”‚                      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”‚ ap-northeast-2a  â”‚ â”‚ â”‚ ap-northeast-2c  â”‚                      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â”‚  10.1.1.0/24     â”‚ â”‚ â”‚ 10.1.10.0/24     â”‚                      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                        â”‚         â”‚                                 â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                        â”‚   Python HTTP                             â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                        â”‚    Web Server                             â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                        â”‚   (Port 80)                               â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ë„¤íŠ¸ì›Œí¬ í”Œë¡œìš° ìƒì„¸ ë‹¤ì´ì–´ê·¸ë¨

```
ğŸŒ External Client
    â†“ HTTP/HTTPS Request
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Internet Gateway (Central VPC)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ Route to ALB
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Internet-facing ALB (Public Subnets)                            â”‚
â”‚    â€¢ Health Check: /health                                      â”‚
â”‚    â€¢ Ports: 80, 443                                             â”‚
â”‚    â€¢ Target: Internal NLB IPs                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ Forward to NLB IPs
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Internal NLB (Private Subnets)                                  â”‚
â”‚    â€¢ Health Check: HTTP 8080 /health                            â”‚
â”‚    â€¢ Target: Proxy Instances                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ Load Balance to Proxies
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx Proxy Instances(2ê°œ Multi-AZ)                           â”‚
â”‚    â€¢ Listen: Port 8080                                          â”‚
â”‚    â€¢ Upstream: Spoke Web Server                                 â”‚
â”‚    â€¢ Security Layer & Request Filtering                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ Proxy Pass via TGW
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Transit Gateway                                              â”‚
â”‚    â€¢ Central â†” Spoke VPC Routing                                â”‚
â”‚    â€¢ Route: 10.1.0.0/16 â†’ Spoke VPC                             â”‚
â”‚    â€¢ Route: 0.0.0.0/0 â†’ Central VPC (from Spoke)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ Route to Spoke VPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Python HTTP Web Server (Spoke VPC)                           â”‚
â”‚    â€¢ Listen: Port 80                                            â”‚
â”‚    â€¢ Response: HTML with Instance Metadata                      â”‚
â”‚    â€¢ Location: Private Subnet (10.1.10.0/24)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ ì£¼ìš” êµ¬ì„± ìš”ì†Œ

### ğŸ¢ Central VPC (ì¤‘ì•™ í—ˆë¸Œ)
- **CIDR**: `10.0.0.0/16`
- **ê°€ìš© ì˜ì—­**: `ap-northeast-2a`, `ap-northeast-2c`
- **êµ¬ì„± ìš”ì†Œ**:
  ```
  ğŸ“ Public Subnets:
    â€¢ 10.0.0.0/24  (AZ-a) - ALB, NAT Gateway
    â€¢ 10.0.1.0/24  (AZ-c) - ALB, NAT Gateway

  ğŸ“ Private Subnets:
    â€¢ 10.0.10.0/24 (AZ-a) - NLB, Proxy Instance
    â€¢ 10.0.11.0/24 (AZ-c) - NLB, Proxy Instance
  ```

### ğŸ¯ Spoke VPC (ì›Œí¬ë¡œë“œ)
- **CIDR**: `10.1.0.0/16`
- **íŠ¹ì§•**:
  - âŒ Internet Gateway ì—†ìŒ (Centralë¥¼ í†µí•´ì„œë§Œ ì¸í„°ë„· ì ‘ê·¼)
  - ğŸ Python3 HTTP ì„œë²„ë¥¼ ì‹¤í–‰í•˜ëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤
  - ğŸš› Transit Gatewayë¥¼ í†µí•´ Central VPCì™€ ì—°ê²°
- **êµ¬ì„± ìš”ì†Œ**:
  ```
  ğŸ“ Subnets:
    â€¢ 10.1.1.0/24  (AZ-a) - Main Subnet
    â€¢ 10.1.10.0/24 (AZ-c) - Private Subnet (Web Server)
  ```

### ğŸ” ë³´ì•ˆ êµ¬ì„±
```
ğŸ›¡ï¸ Security Groups:
â”œâ”€â”€ ALB Security Group
â”‚   â”œâ”€â”€ Inbound: HTTP (80), HTTPS (443) from 0.0.0.0/0
â”‚   â””â”€â”€ Outbound: All traffic
â”œâ”€â”€ Proxy Security Group
â”‚   â”œâ”€â”€ Inbound: HTTP (8080), SSH (22) from Central VPC
â”‚   â””â”€â”€ Outbound: All traffic
â””â”€â”€ Spoke Security Group
    â”œâ”€â”€ Inbound: HTTP (80), SSH (22) from Central VPC
    â””â”€â”€ Outbound: All traffic

ğŸ”„ Network Isolation:
â€¢ Spoke VPC has NO direct internet access
â€¢ All traffic routes through Central VPC
â€¢ WAF/Security policies applied at Proxy layer
```

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

- **Infrastructure**: Terraform
- **Cloud Provider**: AWS (ap-northeast-2)
- **Operating System**: Amazon Linux 2023
- **Web Server**: Python3 HTTP Server
- **Proxy**: Nginx
- **Load Balancers**: ALB (Application Load Balancer), NLB (Network Load Balancer)
- **Management**: AWS Systems Manager (SSM)

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
ğŸ“¦ AWS_ALB_NLB_WAF_TGW_NLB_EC2/
â”œâ”€â”€ ğŸ“„ main.tf                 # Provider ì„¤ì • ë° ê³µí†µ ë°ì´í„°
â”œâ”€â”€ ğŸ“„ variables.tf            # ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ ğŸ“„ hub-vpc.tf             # Central VPC ë° ë„¤íŠ¸ì›Œí‚¹ ë¦¬ì†ŒìŠ¤
â”œâ”€â”€ ğŸ“„ transit-gateway.tf     # Transit Gateway ì„¤ì •
â”œâ”€â”€ ğŸ“„ spoke-vpcs.tf          # Spoke VPC ì •ì˜
â”œâ”€â”€ ğŸ“„ load-balancers.tf      # ALB/NLB ì„¤ì •
â”œâ”€â”€ ğŸ“„ proxy-instances.tf     # Nginx Proxy ì¸ìŠ¤í„´ìŠ¤
â”œâ”€â”€ ğŸ“„ spoke-instances.tf     # Spoke VPC ì›¹ ì„œë²„
â”œâ”€â”€ ğŸ“„ iam.tf                 # IAM ì—­í•  ë° SSM ì„¤ì •
â”œâ”€â”€ ğŸ“„ outputs.tf             # ì¶œë ¥ ê°’ë“¤
â”œâ”€â”€ ğŸ“„ proxy-config.tftpl     # Nginx ì„¤ì • í…œí”Œë¦¿
â””â”€â”€ ğŸ“„ terraform.tfvars.example # ë³€ìˆ˜ ì˜ˆì œ íŒŒì¼
```

## ğŸš€ ë°°í¬ ë°©ë²•

### 1. ì‚¬ì „ ì¤€ë¹„
```bash
# AWS CLI ì„¤ì • í™•ì¸
aws configure list

# Terraform ì„¤ì¹˜ í™•ì¸
terraform version
```

### 2. ë³€ìˆ˜ ì„¤ì •
```bash
# terraform.tfvars íŒŒì¼ ìƒì„±
cp terraform.tfvars.example terraform.tfvars

# í•„ìš”í•œ ë³€ìˆ˜ ìˆ˜ì •
vim terraform.tfvars
```

### 3. ë°°í¬ ì‹¤í–‰
```bash
# Terraform ì´ˆê¸°í™”
terraform init

# ë°°í¬ ê³„íš í™•ì¸
terraform plan

# ë°°í¬ ì‹¤í–‰
terraform apply
```

### 4. ë¦¬ì†ŒìŠ¤ ì •ë¦¬
```bash
# ëª¨ë“  ë¦¬ì†ŒìŠ¤ ì‚­ì œ
terraform destroy
```

## ğŸ”§ ì£¼ìš” ë³€ìˆ˜

| ë³€ìˆ˜ëª… | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|--------|------|
| `aws_region` | ap-northeast-2 | AWS ë¦¬ì „ |
| `project_name` | central-spoke | í”„ë¡œì íŠ¸ ì´ë¦„ |
| `environment` | prod | í™˜ê²½ ì´ë¦„ |
| `central_vpc_cidr` | 10.0.0.0/16 | Central VPC CIDR |
| `spoke_vpc_cidr` | 10.1.0.0/16 | Spoke VPC CIDR |
| `instance_type` | t3.medium | EC2 ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… |
| `key_name` | "" | EC2 í‚¤ í˜ì–´ ì´ë¦„ |

## ğŸ“Š ì¶œë ¥ ê°’

ë°°í¬ ì™„ë£Œ í›„ ë‹¤ìŒ ì •ë³´ë“¤ì´ ì¶œë ¥ë©ë‹ˆë‹¤:

```
ğŸŒ Network Endpoints:
â”œâ”€â”€ alb_dns_name: Internet-facing ALB DNS ì´ë¦„
â”œâ”€â”€ nlb_dns_name: Internal NLB DNS ì´ë¦„
â””â”€â”€ spoke_instance_ip: Spoke VPC ì›¹ ì„œë²„ Private IP

ğŸ—ï¸ Infrastructure IDs:
â”œâ”€â”€ central_vpc_id: Central VPC ID
â”œâ”€â”€ spoke_vpc_id: Spoke VPC ID
â””â”€â”€ transit_gateway_id: Transit Gateway ID

ğŸ’» Instance Information:
â”œâ”€â”€ proxy_instance_ids: Proxy ì¸ìŠ¤í„´ìŠ¤ IDë“¤
â””â”€â”€ spoke_web_instance_id: Spoke ì›¹ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ID
```

## ğŸŒ ë„¤íŠ¸ì›Œí¬ í”Œë¡œìš°

### ğŸ“¥ ì¸ë°”ìš´ë“œ íŠ¸ë˜í”½
```
1. External Client
   â†“ HTTP Request
2. Internet Gateway
   â†“ Route to Public Subnet
3. Internet-facing ALB (Public Subnet)
   â†“ Forward to NLB IPs
4. Internal NLB (Private Subnet)
   â†“ Load Balance
5. Nginx Proxy Instances (2ê°œ, ë¡œë“œë°¸ëŸ°ì‹±)
   â†“ Proxy Pass
6. Transit Gateway
   â†“ Route to Spoke
7. Spoke VPC Python Web Server
```

### ğŸ“¤ ì•„ì›ƒë°”ìš´ë“œ íŠ¸ë˜í”½ (Spoke VPC)
```
1. Spoke EC2 Instance
   â†“ Route via TGW
2. Transit Gateway
   â†“ Route to Central
3. Central VPC Private Subnets
   â†“ Route via NAT
4. NAT Gateway
   â†“ Route to Internet
5. Internet Gateway
```

## ğŸ¯ ì£¼ìš” íŠ¹ì§•

1. **âœ¨ Count ë¯¸ì‚¬ìš©**: ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ê°œë³„ì ìœ¼ë¡œ ì •ì˜í•˜ì—¬ ëª…í™•í•œ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
2. **ğŸ†• Amazon Linux 2023**: ìµœì‹  OS ì‚¬ìš©
3. **ğŸ¢ Multi-AZ ê³ ê°€ìš©ì„±**: 2ê°œ ê°€ìš© ì˜ì—­ í™œìš©
4. **ğŸ”„ Central-Spoke ì•„í‚¤í…ì²˜**: ì¤‘ì•™ ì§‘ì¤‘ì‹ ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬
5. **ğŸ”’ ë³´ì•ˆ í”„ë¡ì‹œ**: Nginxë¥¼ í†µí•œ íŠ¸ë˜í”½ í•„í„°ë§ ë° ë¡œë“œë°¸ëŸ°ì‹±
6. **ğŸš« ì™„ì „í•œ ê²©ë¦¬**: Spoke VPCì˜ ì¸í„°ë„· ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨
7. **ğŸ› ï¸ SSM ì§€ì›**: AWS Systems Managerë¥¼ í†µí•œ ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬

## ğŸ” ëª¨ë‹ˆí„°ë§ ë° ë¡œê·¸

### âœ… Health Check
- **ALB**: `/health` ê²½ë¡œ ì²´í¬
- **NLB**: HTTP 8080 í¬íŠ¸ `/health` ì²´í¬
- **Spoke EC2**: Python HTTP ì„œë²„ í¬íŠ¸ 80 ì²´í¬

### ğŸ“‹ ë¡œê·¸ ìœ„ì¹˜
- **Nginx ë¡œê·¸**: `/var/log/nginx/`
- **Python HTTP ì„œë²„ ë¡œê·¸**: `/var/log/simple-http.log`

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### âš ï¸ ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

1. **ALB Health Check ì‹¤íŒ¨**
   - Proxy ì¸ìŠ¤í„´ìŠ¤ì˜ `/health` ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
   - Security Group ê·œì¹™ ì ê²€

2. **Spoke VPC ì—°ê²° ë¬¸ì œ**
   - Transit Gateway ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸
   - Security Group ê°„ í†µì‹  ê·œì¹™ ì ê²€

3. **DNS í•´ìƒë„ ë¬¸ì œ**
   - VPC DNS ì„¤ì • í™•ì¸ (enable_dns_hostnames, enable_dns_support)

### ğŸ’¡ ìœ ìš©í•œ ëª…ë ¹ì–´

```bash
# Terraform ìƒíƒœ í™•ì¸
terraform show

# íŠ¹ì • ë¦¬ì†ŒìŠ¤ ì •ë³´ í™•ì¸
terraform state show aws_lb.internet_facing

# ë¦¬ì†ŒìŠ¤ ì˜ì¡´ì„± ê·¸ë˜í”„ ìƒì„±
terraform graph | dot -Tsvg > graph.svg

# SSMì„ í†µí•œ ì¸ìŠ¤í„´ìŠ¤ ì—°ê²°
aws ssm start-session --target <instance-id>

# ì—°ê²° í…ŒìŠ¤íŠ¸
curl http://<alb-dns-name>
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
```bash
# ALBë¥¼ í†µí•œ ì—”ë“œíˆ¬ì—”ë“œ í…ŒìŠ¤íŠ¸
curl http://central-spoke-internet-alb-1704316430.ap-northeast-2.elb.amazonaws.com

# ì‘ë‹µ ì˜ˆì‹œ:
# <html>
# <head><title>Spoke VPC Web Server</title></head>
# <body>
#     <h1>Spoke VPC Web Server</h1>
#     <p>Hostname: ip-10-1-10-107.ap-northeast-2.compute.internal</p>
#     <p>Instance ID: i-0091df477a905dba1</p>
#     <p>VPC: 10.1.0.0/16</p>
#     <p>Server: Python HTTP Server</p>
# </body>
# </html>
```

### 2. ì—°ê²°ì„± í…ŒìŠ¤íŠ¸
```bash
# Proxyì—ì„œ Spokeë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸ (SSM ì‚¬ìš©)
aws ssm start-session --target <proxy-instance-id>
# í”„ë¡ì‹œì—ì„œ:
telnet 10.1.10.107 80
telnet 10.1.10.107 22
```

## ğŸ“ ë¼ì´ì„¼ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” êµìœ¡ ë° ë°ëª¨ ëª©ì ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤.

## ğŸ¤ ê¸°ì—¬ ë°©ë²•

1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

---

**âš ï¸ ì°¸ê³ **: ì´ êµ¬ì„±ì€ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ê¸° ì „ì— ë³´ì•ˆ ê²€í†  ë° ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ë¥¼ ê±°ì³ì•¼ í•©ë‹ˆë‹¤.

**ğŸ¯ ì„±ê³µ í™•ì¸**: ìœ„ì˜ í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´ë¡œ `Spoke VPC Web Server` ì‘ë‹µì„ ë°›ìœ¼ë©´ ì „ì²´ ì•„í‚¤í…ì²˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤!